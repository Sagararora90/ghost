<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSP adjusted for AI APIs -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://api.groq.com https://api-inference.huggingface.co https://router.huggingface.co https://generativelanguage.googleapis.com; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
    <title>Ghost AI</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Google Fonts for modern typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="ghost-app">
        <!-- HEADER -->
        <header class="ghost-header">
            <div class="header-left">
                <!-- Using generic ghost icon if local logo is not available in assets, though we can use a CSS mask or pure emoji -->
                <div class="ghost-logo-container">
                    <span class="ghost-icon">üëª</span>
                    <!-- You can replace the emoji with the generated image by pointing src to the image file once moved to assets -->
                </div>
                <h1 class="app-name">GHOST</h1>
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span id="ghostStatusText" class="status-text">Ready</span>
                </div>
            </div>
            <div class="header-right">
                <button id="settingsBtn" class="icon-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                </button>
                <div class="window-controls">
                    <button id="hideBtn" class="control-btn">_</button>
                    <button id="exitBtn" class="control-btn exit">‚úï</button>
                </div>
            </div>
        </header>

        <!-- MODE SELECTOR TABS -->
        <nav class="mode-tabs">
            <button class="mode-tab active" data-mode="interview">Interview</button>
            <button class="mode-tab" data-mode="coding">Coding</button>
            <button class="mode-tab" data-mode="hr">HR</button>
            <button class="mode-tab" data-mode="system">System Design</button>
        </nav>

        <!-- MAIN CONTENT AREA -->
        <main class="ghost-main">
            <!-- Live Question Detection Panel -->
            <section class="live-panel">
                <div class="listening-area">
                    <div id="waveform" class="waveform hidden">
                        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                    </div>
                    <!-- Reuse the messageInput so we don't break renderer logic -->
                    <textarea id="messageInput" class="live-transcription" placeholder="Awaiting audio or text input..." rows="2"></textarea>
                </div>
                <div class="live-actions">
                    <button id="sendButton" class="ghost-btn primary">Analyze &gt;</button>
                </div>
            </section>

            <!-- AI Suggested Answer Card -->
            <section class="ai-card" id="chatContainer">
                <div class="card-header">
                    <span class="card-title">‚ú® AI Analysis</span>
                    <div class="card-actions">
                        <button id="copyAnswerBtn" class="icon-btn copy-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                        <button id="toggleExpandBtn" class="icon-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>
                        </button>
                    </div>
                </div>
                <!-- Messages will be injected here by renderer.js -->
                <div id="messages" class="messages-container">
                    <div class="message system startup hidden">
                        <!-- Left hidden as it's legacy -->
                    </div>
                    <!-- Placeholder UI while waiting -->
                    <div class="empty-state">
                        <span class="typing-indicator hidden">
                            <span></span><span></span><span></span>
                        </span>
                        <p class="empty-text">Listening for context...</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- FLOATING CONTROLS (Bottom Action Bar) -->
        <div class="floating-controls">
            <button id="listenBtn" class="action-fab primary">
                <span class="fab-icon">üéôÔ∏è</span>
                <span class="fab-label">Listen</span>
            </button>
            <button id="stopListeningBtn" class="action-fab danger hidden">
                <span class="fab-icon">üõë</span>
                <span class="fab-label">Stop</span>
            </button>
            <button id="analyseScreenBtn" class="action-fab secondary">
                <span class="fab-icon">üì∑</span>
                <span class="fab-label">Screen</span>
            </button>
            <button id="answerQuestionBtn" class="action-fab subtle hidden">
                <span class="fab-icon">üí¨</span>
                <span class="fab-label">Answer</span>
            </button>
        </div>

        <!-- HIDDEN OVERLAYS FOR COMPATIBILITY WITH renderer.js -->
        <!-- OCR Overlay -->
        <div id="ocrOverlay" class="ghost-overlay hidden">
            <div class="overlay-panel">
                <h3>Select Text to Analyze</h3>
                <div id="ocrLines" class="ocr-list"></div>
                <div class="overlay-actions">
                    <button id="cancelOcr" class="ghost-btn text-btn">Cancel</button>
                    <button id="sendOcr" class="ghost-btn primary" disabled>Analyze Selection</button>
                </div>
            </div>
        </div>

        <!-- Settings Modal (Redesigned) -->
        <div id="settingsModal" class="ghost-overlay hidden">
            <div class="overlay-panel settings-panel">
                <div class="panel-header">
                    <h2>‚öôÔ∏è System Configuration</h2>
                    <button id="closeSettings" class="close-icon">‚úï</button>
                </div>
                <div class="panel-body">
                    <div class="setting-group">
                        <label>AI Keys <span class="hint">(Groq/HF/Gemini)</span></label>
                        <textarea id="groqKeyInput" class="glow-input" rows="3" placeholder="gsk_...&#10;hf_...&#10;AIza..."></textarea>
                    </div>
                    <div class="setting-group">
                        <label>Core Protocol (Resume)</label>
                        <div class="file-action-row">
                            <button id="uploadResumeBtn" class="ghost-btn outline">üìÑ Upload</button>
                            <span id="uploadStatus" class="status-label hidden"></span>
                        </div>
                        <div id="resumeFileList" class="file-list"></div>
                        <textarea id="userBioInput" class="glow-input" rows="2" placeholder="Paste data..."></textarea>
                    </div>
                    <div class="setting-group">
                        <label>Target Parameters (JD)</label>
                        <div class="file-action-row">
                            <button id="uploadJdBtn" class="ghost-btn outline">üìÑ Upload JD</button>
                            <span id="jdUploadStatus" class="status-label hidden"></span>
                        </div>
                        <div id="jdFileList" class="file-list"></div>
                        <textarea id="userJdInput" class="glow-input" rows="2" placeholder="Paste JD..."></textarea>
                    </div>
                    <div class="setting-group">
                        <label>Codebase Directives</label>
                        <div class="file-action-row">
                            <button id="uploadProjectBtn" class="ghost-btn outline">üì¶ ZIP</button>
                            <button id="uploadProjectFolderBtn" class="ghost-btn outline">üìÅ Folder</button>
                            <span id="projectUploadStatus" class="status-label hidden"></span>
                        </div>
                        <div id="projectFileList" class="file-list"></div>
                        <textarea id="userProjectsInput" class="glow-input" rows="2" placeholder="Paste code..."></textarea>
                    </div>
                    <div class="panel-footer">
                        <div class="footer-cluster">
                            <button id="wipeAllData" class="ghost-btn danger">Purge</button>
                            <button id="resetFocusBtn" class="ghost-btn outline">Reset Focus</button>
                            <button id="checkForUpdatesBtn" class="ghost-btn outline">Update</button>
                        </div>
                        <button id="saveSettings" class="ghost-btn primary">Sync</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Auth Overlay -->
        <div id="authOverlay" class="ghost-overlay hidden">
            <div class="overlay-panel auth-panel">
                <div class="auth-brand">
                    <span class="ghost-icon large">üëª</span>
                    <h3 id="authTitle" class="neon-text">GHOST PROTOCOL</h3>
                </div>
                <div class="auth-form">
                    <input type="text" id="authUsername" class="glow-input" placeholder="ID.Name" autocomplete="off" spellcheck="false">
                    <input type="password" id="authPassword" class="glow-input" placeholder="Passkey" autocomplete="off">
                    <textarea id="authKeyInput" class="glow-input hidden" rows="2" placeholder="API Keys (Groq/HF/Gemini)"></textarea>
                    <div id="authError" class="auth-error hidden"></div>
                    <button id="authSubmit" class="ghost-btn primary w-full">Initialize</button>
                    <div class="auth-toggle">
                        <span id="authToggleText">Unauthorized?</span>
                        <button id="authToggleBtn" class="link-btn">Request Access</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onboarding Overlay -->
        <div id="onboardingOverlay" class="ghost-overlay hidden">
            <div class="overlay-panel auth-panel">
                <h3 class="neon-text">SYSTEM ONLINE</h3>
                <p class="onboard-text">Provide neural link API key to proceed.</p>
                <input type="text" id="onboardingKeyInput" class="glow-input" placeholder="Valid API Key required...">
                <button id="finishOnboarding" class="ghost-btn primary w-full mt-4">Engage</button>
            </div>
        </div>

    </div>

    <!-- Hidden elements kept for renderer compatibility -->
    <div style="display:none;">
        <span id="focusCounter">0</span>
        <div id="listeningIndicator"><span id="timerDisplay">00:00</span></div>
    </div>

    <div id="toastContainer" class="ghost-toasts"></div>

    <script src="node_modules/marked/lib/marked.umd.js"></script>
    <script src="renderer.js"></script>
    <script>
        // Inline UI logic for tabs, expand, etc.
        document.addEventListener('DOMContentLoaded', () => {
            // Mode Tabs
            const tabs = document.querySelectorAll('.mode-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    // Add logic to prepend standard mode context when "analyze" is clicked or modifying prompt implicitly
                });
            });

            // Toggle Expand AI Card
            const toggleBtn = document.getElementById('toggleExpandBtn');
            const aiCard = document.querySelector('.ai-card');
            if(toggleBtn && aiCard) {
                toggleBtn.addEventListener('click', () => {
                    aiCard.classList.toggle('expanded');
                });
            }

            // Copy Action
            const copyBtn = document.getElementById('copyAnswerBtn');
            if(copyBtn) {
                copyBtn.addEventListener('click', () => {
                    const messages = document.getElementById('messages');
                    const text = messages.innerText;
                    navigator.clipboard.writeText(text);
                    // Show a quick visual feedback
                    copyBtn.classList.add('success');
                    setTimeout(() => copyBtn.classList.remove('success'), 1000);
                });
            }
        });
    </script>
</body>
</html>
