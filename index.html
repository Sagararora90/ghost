<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSP adjusted for AI APIs -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://api.groq.com https://api-inference.huggingface.co https://router.huggingface.co https://generativelanguage.googleapis.com; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
    <title>Ghost AI</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Top Control Bar -->
        <header class="top-bar">
            <div class="brand-section">
                <div class="status-dot online"></div>
                <span class="brand-name">Ghost AI</span>
                <span id="ghostStatus" class="ghost-badge">üëª</span>
                <span id="focusCounter" class="focus-badge">0</span>
            </div>
            
            <div class="window-controls">
                <div id="listeningIndicator" class="listening-badge hidden">
                    <span class="pulse-dot"></span> <span id="timerDisplay">00:00</span>
                </div>
                <button id="stopListeningBtn" class="control-btn danger hidden">Stop</button>
                <button id="hideBtn" class="control-btn">Hide</button>
                <button id="exitBtn" class="control-btn danger-icon">‚úï</button>
            </div>
        </header>

        <!-- Action Bar -->
        <div class="action-bar">
            <div class="action-buttons">
                <button id="analyseScreenBtn" class="action-pill primary">üì∑ Analyse Screen</button>
                <button id="listenBtn" class="action-pill secondary">üéôÔ∏è Listen</button>
                <button id="answerQuestionBtn" class="action-pill secondary">üí¨ Answer</button>
                <button id="settingsBtn" class="action-pill subtle">‚öôÔ∏è</button>
            </div>
        </div>

        <!-- Main Content Area (Scrollable) -->
        <main id="chatContainer" class="content-area">
            <div id="messages" class="messages-list">
                <div class="message system startup">
                    <div class="content-block">
                        <div class="block-body">System Ready. Invisible Mode Active.</div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Input Area -->
        <div class="input-area">
            <textarea id="messageInput" placeholder="Type or paste question..." rows="1"></textarea>
            <button id="sendButton" class="send-btn">‚û§</button>
        </div>

        <!-- OCR Overlay -->
        <div id="ocrOverlay" class="overlay hidden">
            <div class="overlay-content">
                <h3>Select Text to Analyze</h3>
                <div id="ocrLines" class="ocr-list"></div>
                <div class="overlay-actions">
                    <button id="cancelOcr" class="btn text-btn">Cancel</button>
                    <button id="sendOcr" class="btn primary-btn" disabled>Analyze Selection</button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="overlay hidden">
            <div class="modal-box settings-modal">
                <div class="modal-header">
                    <h2>‚öôÔ∏è Settings</h2>
                    <button id="closeSettings" class="close-icon">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- API Keys -->
                    <div class="setting-group">
                        <label>API Keys <span class="hint">(one per line: Groq/HF/Gemini)</span></label>
                        <textarea id="groqKeyInput" class="code-input" rows="3" placeholder="gsk_...&#10;hf_...&#10;AIza..."></textarea>
                    </div>

                    <!-- Resume / Bio -->
                    <div class="setting-group">
                        <label>Resume / Bio</label>
                        <div class="file-upload-row">
                            <button id="uploadResumeBtn" class="btn sm-btn">üìÑ Upload</button>
                            <span id="uploadStatus" class="status-label hidden"></span>
                        </div>
                        <div id="resumeFileList" class="file-list"></div>
                        <textarea id="userBioInput" rows="2" placeholder="Or paste resume text..."></textarea>
                    </div>

                    <!-- Job Description -->
                    <div class="setting-group">
                        <label>Job Description</label>
                        <div class="file-upload-row">
                            <button id="uploadJdBtn" class="btn sm-btn">üìÑ Upload JD</button>
                            <span id="jdUploadStatus" class="status-label hidden"></span>
                        </div>
                        <div id="jdFileList" class="file-list"></div>
                        <textarea id="userJdInput" rows="2" placeholder="Target role JD..."></textarea>
                    </div>

                    <!-- Projects -->
                    <div class="setting-group">
                        <label>Project Code</label>
                        <div class="file-upload-row">
                            <button id="uploadProjectBtn" class="btn sm-btn">üì¶ ZIP</button>
                            <button id="uploadProjectFolderBtn" class="btn sm-btn">üìÅ Folder</button>
                            <span id="projectUploadStatus" class="status-label hidden"></span>
                        </div>
                        <div id="projectFileList" class="file-list"></div>
                        <textarea id="userProjectsInput" rows="2" placeholder="Or paste project code..."></textarea>
                    </div>

                    <!-- Footer -->
                    <div class="modal-footer">
                        <div class="footer-left">
                            <button id="wipeAllData" class="btn danger-btn">üóëÔ∏è Reset All</button>
                            <button id="resetFocusBtn" class="btn text-btn">Reset Focus Counter</button>
                            <button id="checkForUpdatesBtn" class="btn text-btn">Check Updates</button>
                        </div>
                        <button id="saveSettings" class="btn primary-btn">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Auth Overlay (Login/Signup Gate) -->
        <div id="authOverlay" class="overlay hidden">
            <div class="overlay-content auth-box">
                <div class="auth-header">
                    <span class="auth-icon">üëª</span>
                    <h3 id="authTitle">Login</h3>
                </div>
                <div class="auth-form">
                    <input type="text" id="authUsername" class="auth-input" placeholder="Username" autocomplete="off" spellcheck="false">
                    <input type="password" id="authPassword" class="auth-input" placeholder="Password" autocomplete="off">
                    <textarea id="authKeyInput" class="auth-input hidden" rows="2" placeholder="API Keys (Groq/HF/Gemini) - one per line"></textarea>
                    <div id="authError" class="auth-error hidden"></div>
                    <button id="authSubmit" class="btn primary-btn auth-submit-btn">Login</button>
                    <div class="auth-toggle">
                        <span id="authToggleText">Don't have an account?</span>
                        <button id="authToggleBtn" class="btn-link">Create Account</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onboarding Overlay -->
        <div id="onboardingOverlay" class="overlay hidden">
            <div class="overlay-content onboarding-box">
                <h3>Welcome to Ghost AI üëª</h3>
                <p class="onboard-text">Enter your API key to get started.</p>
                <input type="text" id="onboardingKeyInput" class="code-input" placeholder="gsk_... or hf_... or AIza...">
                <button id="finishOnboarding" class="btn primary-btn" style="width:100%;margin-top:12px;">Start Ghost Mode</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer"></div>

    <script src="renderer.js"></script>
</body>
</html>
